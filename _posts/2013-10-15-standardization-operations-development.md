---
layout: post
title: 运营开发规范化的几项工作
tags: [服务器, Linux, Git, Golang, Python]
---

入职腾讯做运营开发6个月有余。入职之时组内仅有1个运营开发的同事，到目前已扩充到5人，加3个实习生。

入职之时的运营开发过程是这样的：

1.在办公机器（Windows）上编写代码，功能测试通过后，

2.ssh远程连接到生产服务器（Linux），vim打开一个新文件，复制办公机器上的代码，粘贴到vim中，保存，

3.打开浏览器测试上线的功能/效果是否正确，若不正确，

4.直接在生产服务器上编辑代码文件，直到达到需要的功能效果，

5.再从生产服务器上将修改后的代码复制粘贴到办公机器（也许不会有这一步，之后所有的修改都直接在生产服务器上操作）。

这个过程存在如下问题：

1.代码没有版本控制

2.没有与生产服务器一致的测试环境

3.代码部署过程繁琐

4.办公开发机器上代码很可能比生产服务器上代码还旧

5.上面4点都会导致混乱

除此之外，当团队从1人扩充到多人后，不可避免地会遇到协作的问题，解决代码开发协作问题一般涉及如下几方面：

1.使用代码版本控制

2.规定版本控制的工作流

3.编码规范

4.项目/代码文档

5.定期code review

为了解决上述问题，我陆续地做了如下工作：

### 搭建Gitlab服务器、测试服务器

个人认为开发工作规范化的第一点就是版本控制，基于版本控制可以完成很多自动化的任务。

平时个人的代码、文档都通过Git版本控制存放在Github上，所以选择Gitlab来自建类Github平台，服务器的搭建过程见： [搭建测试服务器(源码编译方式)](http://youngsterxyf.github.io/2013/06/18/setup-testing-server/)。

测试服务器和Gitlab服务器是同一台机器，在Git服务器端某个版本库的hooks目录下添加post-receive hook脚本，当有代码提交时，触发执行该脚本，脚本会将该版本库各个分支的代码更新到特定目录中，
然后以每个目录为root添加Nginx虚拟主机配置。这样每次代码提交后，就可以直接打开浏览器查看效果了。hook脚本代码见：[post-receive.py](https://gist.github.com/youngsterxyf/6988132)。

该hook脚本的实现比较暴力---任何代码提交都会检查签出所有分支代码。

目前为止，Gitlab平台已得到较好的使用，但由于所要开发的运营平台涉及到一些监控数据API问题，很难有效地使用测试服务器，所以测试服务器一直没有正式使用起来。

