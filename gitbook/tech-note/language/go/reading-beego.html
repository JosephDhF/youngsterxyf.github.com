<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Beego源码阅读 | Xiayf的技术笔记</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.3.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="../../language/js.html" />
    
    
    <link rel="prev" href="../../language/go/learning-go.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="3.3.3" data-basepath="../.." data-revision="Mon Jan 18 2016 13:26:46 GMT+0800 (CST)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="arch/index.html">
            
                
                    <a href="../../arch/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        架构
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="arch/tumblr-arch.html">
            
                
                    <a href="../../arch/tumblr-arch.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Tumblr架构设计
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="arch/latency-output-cost.html">
            
                
                    <a href="../../arch/latency-output-cost.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        &lt;延迟、吞吐、成本那些事&gt;课程笔记
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="arch/reference.html">
            
                
                    <a href="../../arch/reference.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        资料
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="basic/index.html">
            
                
                    <a href="../../basic/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        基础
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="basic/system.html">
            
                
                    <a href="../../basic/system.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        系统编程
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="basic/system/tlpi.html">
            
                
                    <a href="../../basic/system/tlpi.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.1.</b>
                        
                        读书笔记：Linux/UNIX系统编程手册
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="basic/algorithm.html">
            
                
                    <a href="../../basic/algorithm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        算法
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="basic/algorithm/introduction-to-algorithm.html">
            
                
                    <a href="../../basic/algorithm/introduction-to-algorithm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.1.</b>
                        
                        读书笔记：算法导论
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="basic/network.html">
            
                
                    <a href="../../basic/network.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        网络
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="basic/compiler.html">
            
            <span><b>2.4.</b> 编译</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="basic/compiler/flex-bison.html">
            
                
                    <a href="../../basic/compiler/flex-bison.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.1.</b>
                        
                        读书笔记：flex与bison
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="basic/storage.html">
            
            <span><b>2.5.</b> 存储</span>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="language/index.html">
            
                
                    <a href="../../language/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        编程语言
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="language/python.html">
            
                
                    <a href="../../language/python.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Python
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="language/python/flask.html">
            
                
                    <a href="../../language/python/flask.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.1.</b>
                        
                        Flask
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="language/python/tornado.html">
            
                
                    <a href="../../language/python/tornado.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.2.</b>
                        
                        Tornado
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="language/python/django.html">
            
                
                    <a href="../../language/python/django.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.3.</b>
                        
                        Django
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="language/php.html">
            
                
                    <a href="../../language/php.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        PHP
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="language/php/yii.html">
            
            <span><b>3.2.1.</b> Yii</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.2.2" data-path="language/php/symfony.html">
            
            <span><b>3.2.2.</b> Symfony</span>
            
            
        </li>
    
        <li class="chapter " data-level="3.2.3" data-path="language/php/internal.html">
            
                
                    <a href="../../language/php/internal.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.3.</b>
                        
                        读书笔记：深入理解PHP内核
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="language/go.html">
            
                
                    <a href="../../language/go.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Go
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="language/go/effective-go.html">
            
                
                    <a href="../../language/go/effective-go.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.1.</b>
                        
                        Effective Go
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="language/go/learning-go.html">
            
                
                    <a href="../../language/go/learning-go.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.2.</b>
                        
                        读书笔记：Go学习笔记
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="3.3.3" data-path="language/go/reading-beego.html">
            
                
                    <a href="../../language/go/reading-beego.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.</b>
                        
                        Beego源码阅读
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" data-path="language/js.html">
            
                
                    <a href="../../language/js.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                        JavaScript
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="language/js/frontend-dv.html">
            
                
                    <a href="../../language/js/frontend-dv.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.1.</b>
                        
                        前端数据可视化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.2" data-path="language/js/modular.html">
            
                
                    <a href="../../language/js/modular.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.2.</b>
                        
                        前端模块化
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.3" data-path="language/js/tools.html">
            
                
                    <a href="../../language/js/tools.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.3.</b>
                        
                        前端工具
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.4" data-path="language/js/hybrid-mobile.html">
            
                
                    <a href="../../language/js/hybrid-mobile.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.4.</b>
                        
                        混合移动开发
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.4.5" data-path="language/js/node.html">
            
                
                    <a href="../../language/js/node.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.5.</b>
                        
                        NodeJS
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.5.1" data-path="language/js/node/reading-node.html">
            
                
                    <a href="../../language/js/node/reading-node.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.5.1.</b>
                        
                        NodeJS源码阅读笔记
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.5" data-path="language/css.html">
            
                
                    <a href="../../language/css.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                        CSS
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.6" data-path="language/c.html">
            
                
                    <a href="../../language/c.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                        C
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.6.1" data-path="language/c/learning-c.html">
            
                
                    <a href="../../language/c/learning-c.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.1.</b>
                        
                        读书笔记：C学习笔记
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.7" data-path="language/lua.html">
            
                
                    <a href="../../language/lua.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.7.</b>
                        
                        Lua
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8" data-path="language/java.html">
            
                
                    <a href="../../language/java.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.</b>
                        
                        Java/Scala
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.8.1" data-path="language/java/play.html">
            
                
                    <a href="../../language/java/play.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.1.</b>
                        
                        Play
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8.2" data-path="language/java/spring.html">
            
                
                    <a href="../../language/java/spring.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.2.</b>
                        
                        Spring
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.8.3" data-path="language/java/spark.html">
            
                
                    <a href="../../language/java/spark.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.8.3.</b>
                        
                        Spark
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.9" data-path="language/others.html">
            
                
                    <a href="../../language/others.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.9.</b>
                        
                        others
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="operation/index.html">
            
                
                    <a href="../../operation/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        运维
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="operation/os.html">
            
                
                    <a href="../../operation/os.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        操作系统
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="operation/sql.html">
            
                
                    <a href="../../operation/sql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                        SQL
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="operation/sql/mysql.html">
            
                
                    <a href="../../operation/sql/mysql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.1.</b>
                        
                        MySQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.2" data-path="operation/sql/high-performance-mysql.html">
            
                
                    <a href="../../operation/sql/high-performance-mysql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.2.</b>
                        
                        读书笔记：高性能MySQL
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.2.3" data-path="operation/sql/sqlite.html">
            
                
                    <a href="../../operation/sql/sqlite.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.3.</b>
                        
                        SQLite
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="operation/nosql.html">
            
                
                    <a href="../../operation/nosql.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                        NoSQL
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.3.1" data-path="operation/nosql/redis-design-implementation.html">
            
                
                    <a href="../../operation/nosql/redis-design-implementation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.1.</b>
                        
                        读书笔记：Redis设计与实现
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="operation/mq.html">
            
                
                    <a href="../../operation/mq.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.4.</b>
                        
                        MQ
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="operation/nginx.html">
            
                
                    <a href="../../operation/nginx.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.</b>
                        
                        Nginx
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.5.1" data-path="operation/nginx/openresty.html">
            
                
                    <a href="../../operation/nginx/openresty.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.5.1.</b>
                        
                        OpenResty
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="operation/haproxy.html">
            
                
                    <a href="../../operation/haproxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.</b>
                        
                        HAProxy
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.6.1" data-path="operation/haproxy/conf-manual.html">
            
                
                    <a href="../../operation/haproxy/conf-manual.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.6.1.</b>
                        
                        HAProxy文档精简翻译版
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="operation/others.html">
            
                
                    <a href="../../operation/others.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.7.</b>
                        
                        其他
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="others/index.html">
            
                
                    <a href="../../others/index.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        其他
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="others/refactoring.html">
            
                
                    <a href="../../others/refactoring.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        读书笔记：重构
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="others/sicp.html">
            
                
                    <a href="../../others/sicp.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        读书笔记：计算机程序的构造与解释
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="others/quotes.html">
            
                
                    <a href="../../others/quotes.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        启示语录
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="others/web.html">
            
                
                    <a href="../../others/web.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Web开发
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="others/ds.html">
            
                
                    <a href="../../others/ds.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.5.</b>
                        
                        分布式系统
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="others/security.html">
            
                
                    <a href="../../others/security.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.6.</b>
                        
                        信息安全
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="others/stackoverflow-collection.html">
            
                
                    <a href="../../others/stackoverflow-collection.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.7.</b>
                        
                        StackOverflow问答精选
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8" data-path="others/other.html">
            
                
                    <a href="../../others/other.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.</b>
                        
                        碎碎念
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.8.1" data-path="others/other/inspired.html">
            
                
                    <a href="../../others/other/inspired.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.1.</b>
                        
                        启示录
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.8.2" data-path="others/other/taobao-ten-years.html">
            
                
                    <a href="../../others/other/taobao-ten-years.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.8.2.</b>
                        
                        读书笔记：淘宝技术这十年
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >Xiayf的技术笔记</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="beego%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0">Beego&#x6E90;&#x7801;&#x9605;&#x8BFB;&#x7B14;&#x8BB0;</h1>
<h2 id="%E7%9B%AE%E5%BD%95">&#x76EE;&#x5F55;</h2>
<ol>
<li>&#x6982;&#x8FF0;</li>
<li>&#x542F;&#x52A8;&#x6D41;&#x7A0B;</li>
<li>&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x4E3B;&#x6D41;&#x7A0B;</li>
<li>&#x914D;&#x7F6E;&#x6A21;&#x5757;</li>
<li>Grace server</li>
<li>&#x4E0A;&#x4E0B;&#x6587;&#x6A21;&#x5757;</li>
<li>&#x8DEF;&#x7531;&#x7BA1;&#x7406;</li>
<li>Session&#x7BA1;&#x7406;</li>
<li>&#x65E5;&#x5FD7;&#x6A21;&#x5757;</li>
<li>&#x7F13;&#x5B58;&#x6A21;&#x5757;</li>
<li>ORM&#x6A21;&#x5757;</li>
</ol>
<h1 id="%E6%A6%82%E8%BF%B0">&#x6982;&#x8FF0;</h1>
<h2 id="beego%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96">Beego&#x7684;&#x6A21;&#x5757;&#x5316;</h2>
<p><img src="media/architecture.png" alt="architecture"></p>
<h2 id="%E8%AF%B7%E6%B1%82%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE">&#x8BF7;&#x6C42;&#x6267;&#x884C;&#x6D41;&#x7A0B;&#x56FE;</h2>
<p><img src="media/flow.png" alt="flo"></p>
<h2 id="bee%E5%B7%A5%E5%85%B7%E7%94%9F%E6%88%90%E7%9A%84beego%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84">Bee&#x5DE5;&#x5177;&#x751F;&#x6210;&#x7684;Beego&#x9879;&#x76EE;&#x7ED3;&#x6784;</h2>
<pre><code>.
&#x251C;&#x2500;&#x2500; conf
&#x2502;   &#x2514;&#x2500;&#x2500; app.conf
&#x251C;&#x2500;&#x2500; controllers
&#x2502;   &#x2514;&#x2500;&#x2500; default.go
&#x251C;&#x2500;&#x2500; main.go
&#x251C;&#x2500;&#x2500; models
&#x251C;&#x2500;&#x2500; routers
&#x2502;   &#x2514;&#x2500;&#x2500; router.go
&#x251C;&#x2500;&#x2500; static
&#x2502;   &#x251C;&#x2500;&#x2500; css
&#x2502;   &#x251C;&#x2500;&#x2500; img
&#x2502;   &#x2514;&#x2500;&#x2500; js
&#x251C;&#x2500;&#x2500; tests
&#x2502;   &#x2514;&#x2500;&#x2500; default_test.go
&#x2514;&#x2500;&#x2500; views
    &#x2514;&#x2500;&#x2500; index.tpl

10 directories, 6 files
</code></pre><h1 id="%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B">&#x542F;&#x52A8;&#x6D41;&#x7A0B;</h1>
<p>&#x5148;&#x6765;&#x770B;&#x770B;Go&#x7684;import&#x903B;&#x8F91;&#xFF0C;&#x56E0;&#x4E3A;Beego&#xFF08;&#x6216;&#x8005;&#x5176;&#x4ED6;Go&#x8BED;&#x8A00;&#x9879;&#x76EE;&#xFF09;&#x7684;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x90FD;&#x4F9D;&#x8D56;&#x4E8E;import&#x7684;&#x903B;&#x8F91;&#x3002;</p>
<p><img src="media/init.png" alt="init"></p>
<hr>
<p>&#x5728;Bee&#x5DE5;&#x5177;&#x751F;&#x6210;&#x7684;Beego&#x9879;&#x76EE;&#x76EE;&#x5F55;&#x4E2D;&#xFF0C;<code>main.go</code>&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    _ <span class="hljs-string">&quot;hello/routers&quot;</span>
    <span class="hljs-string">&quot;github.com/astaxie/beego&quot;</span>
)

<span class="hljs-keyword">func</span> main() {
    beego.Run()
}
</code></pre>
<p><code>routers/router.go</code>&#x5185;&#x5BB9;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> routers

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;hello/controllers&quot;</span>
    <span class="hljs-string">&quot;github.com/astaxie/beego&quot;</span>
)

<span class="hljs-keyword">func</span> init() {
    beego.Router(<span class="hljs-string">&quot;/&quot;</span>, &amp;controllers.MainController{})
}
</code></pre>
<p>&#x4ECE;&#x4EE3;&#x7801;&#x76F4;&#x89C2;&#x6765;&#x770B;&#xFF0C;&#x4E00;&#x4E2A;Beego&#x5E94;&#x7528;&#x7684;&#x542F;&#x52A8;&#x6D41;&#x7A0B;&#x5982;&#x4E0B;&#xFF1A;</p>
<ol>
<li>&#x5F15;&#x5165;beego&#x5305;</li>
<li>&#x6CE8;&#x518C;&#x8DEF;&#x7531;</li>
<li>&#x6267;&#x884C;beego&#x5305;&#x7684;Run&#x65B9;&#x6CD5;</li>
</ol>
<hr>
<p>&#x4ECE;Beego&#x672C;&#x8EAB;&#x7684;&#x5DE5;&#x7A0B;&#x76EE;&#x5F55;&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x5C5E;&#x4E8E;&#x5305;<code>beego</code>&#x7684;&#x6587;&#x4EF6;&#x6709;&#x5F88;&#x591A;&#xFF0C;&#x5176;&#x4E2D;Run&#x65B9;&#x6CD5;&#x5728;&#x6587;&#x4EF6;<code>beego.go</code>&#x4E2D;&#xFF0C;&#x65B9;&#x6CD5;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">// Run beego application.</span>
<span class="hljs-comment">// beego.Run() default run on HttpPort</span>
<span class="hljs-comment">// beego.Run(&quot;:8089&quot;)</span>
<span class="hljs-comment">// beego.Run(&quot;127.0.0.1:8089&quot;)</span>
<span class="hljs-keyword">func</span> Run(params ...<span class="hljs-typename">string</span>) {
   <span class="hljs-comment">// &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8C03;&#x7528;&#x65F6;&#x53EF;&#x4EE5;&#x4F20;&#x5165;&#x5730;&#x5740;&#x7AEF;&#x53E3;&#x53C2;&#x6570;&#xFF0C;&#x4F46;&#x8FD9;&#x91CC;&#x7684;&#x5B9E;&#x73B0;&#x6BD4;&#x8F83;&#x4E11;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(params) &gt; <span class="hljs-number">0</span> &amp;&amp; params[<span class="hljs-number">0</span>] != <span class="hljs-string">&quot;&quot;</span> {
        strs := strings.Split(params[<span class="hljs-number">0</span>], <span class="hljs-string">&quot;:&quot;</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(strs) &gt; <span class="hljs-number">0</span> &amp;&amp; strs[<span class="hljs-number">0</span>] != <span class="hljs-string">&quot;&quot;</span> {
            HttpAddr = strs[<span class="hljs-number">0</span>]
        }
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(strs) &gt; <span class="hljs-number">1</span> &amp;&amp; strs[<span class="hljs-number">1</span>] != <span class="hljs-string">&quot;&quot;</span> {
            HttpPort, _ = strconv.Atoi(strs[<span class="hljs-number">1</span>])
        }
    }
    initBeforeHttpRun()

   <span class="hljs-comment">// &#x5982;&#x679C;&#x914D;&#x7F6E;&#x542F;&#x7528;&#x7BA1;&#x7406;&#x9875;&#x9762;&#xFF08;&#x5176;&#x5B9E;&#x662F;&#x7BA1;&#x7406;&#x670D;&#x52A1;&#x540E;&#x53F0;&#xFF09;</span>
    <span class="hljs-keyword">if</span> EnableAdmin {
        <span class="hljs-keyword">go</span> beeAdminApp.Run()
    }

    BeeApp.Run()
}
</code></pre>
<p>&#x5176;&#x4E2D; <code>initBeforeHttpRun()</code> &#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> initBeforeHttpRun() {
   <span class="hljs-comment">/* &#x4ECE;&#x8FD9;&#x91CC;&#x770B;&#x51FA;&#xFF0C;&#x9ED8;&#x8BA4;&#x7684;&#x914D;&#x7F6E;&#x6709;&#x4E24;&#x5904;&#xFF1A;
   - filepath.Join(AppPath, &quot;conf&quot;, &quot;app.conf&quot;)
   - filepath.Join(workPath, &quot;conf&quot;, &quot;app.conf&quot;)
   */</span>
    <span class="hljs-comment">// if AppConfigPath not In the conf/app.conf reParse config</span>
    <span class="hljs-keyword">if</span> AppConfigPath != filepath.Join(AppPath, <span class="hljs-string">&quot;conf&quot;</span>, <span class="hljs-string">&quot;app.conf&quot;</span>) {
        err := ParseConfig()
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> &amp;&amp; AppConfigPath != filepath.Join(workPath, <span class="hljs-string">&quot;conf&quot;</span>, <span class="hljs-string">&quot;app.conf&quot;</span>) {
            <span class="hljs-comment">// configuration is critical to app, panic here if parse failed</span>
            <span class="hljs-built_in">panic</span>(err)
        }
    }

    <span class="hljs-comment">//init mime</span>
    <span class="hljs-comment">// AddAPPStartHook&#x51FD;&#x6570;&#x53EF;&#x7528;&#x4E8E;&#x5728;&#x5E94;&#x7528;&#x542F;&#x52A8;&#x4E4B;&#x524D;&#x6267;&#x884C;&#x4E00;&#x4E9B;hook</span>
    <span class="hljs-comment">// &#x6700;&#x540E;&#x4E00;&#x4E2A;hook&#x662F;initMime</span>
    AddAPPStartHook(initMime)

    <span class="hljs-comment">// do hooks function</span>
    <span class="hljs-comment">// &#x9010;&#x4E2A;&#x6267;&#x884C;hook</span>
    <span class="hljs-keyword">for</span> _, hk := <span class="hljs-keyword">range</span> hooks {
        err := hk()
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
    }

   <span class="hljs-comment">// &#x5982;&#x679C;&#x914D;&#x7F6E;&#x542F;&#x7528;session</span>
    <span class="hljs-keyword">if</span> SessionOn {
        <span class="hljs-keyword">var</span> err error
        sessionConfig := AppConfig.String(<span class="hljs-string">&quot;sessionConfig&quot;</span>)
        <span class="hljs-keyword">if</span> sessionConfig == <span class="hljs-string">&quot;&quot;</span> {
            sessionConfig = <span class="hljs-string">`{&quot;cookieName&quot;:&quot;`</span> + SessionName + <span class="hljs-string">`&quot;,`</span> +
                <span class="hljs-string">`&quot;gclifetime&quot;:`</span> + strconv.FormatInt(SessionGCMaxLifetime, <span class="hljs-number">10</span>) + <span class="hljs-string">`,`</span> +
                <span class="hljs-string">`&quot;providerConfig&quot;:&quot;`</span> + filepath.ToSlash(SessionSavePath) + <span class="hljs-string">`&quot;,`</span> +
                <span class="hljs-string">`&quot;secure&quot;:`</span> + strconv.FormatBool(EnableHttpTLS) + <span class="hljs-string">`,`</span> +
                <span class="hljs-string">`&quot;enableSetCookie&quot;:`</span> + strconv.FormatBool(SessionAutoSetCookie) + <span class="hljs-string">`,`</span> +
                <span class="hljs-string">`&quot;domain&quot;:&quot;`</span> + SessionDomain + <span class="hljs-string">`&quot;,`</span> +
                <span class="hljs-string">`&quot;cookieLifeTime&quot;:`</span> + strconv.Itoa(SessionCookieLifeTime) + <span class="hljs-string">`}`</span>
        }
        GlobalSessions, err = session.NewManager(SessionProvider,
            sessionConfig)
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            <span class="hljs-built_in">panic</span>(err)
        }
        <span class="hljs-keyword">go</span> GlobalSessions.GC()
    }

   <span class="hljs-comment">// &#x52A0;&#x8F7D;&#x6240;&#x6709;&#x7684;&#x6A21;&#x677F;&#x6587;&#x4EF6;</span>
    <span class="hljs-comment">// ViewsPath&#x9ED8;&#x8BA4;&#x4E3A;views&#x5B50;&#x76EE;&#x5F55;</span>
    err := BuildTemplate(ViewsPath)
    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
        <span class="hljs-keyword">if</span> RunMode == <span class="hljs-string">&quot;dev&quot;</span> {
            Warn(err)
        }
    }

   <span class="hljs-comment">// &#x6CE8;&#x518C;&#x9ED8;&#x8BA4;&#x7684;&#x9519;&#x8BEF;&#x5904;&#x7406;&#x65B9;&#x6CD5;</span>
    registerDefaultErrorHandler()

    <span class="hljs-keyword">if</span> EnableDocs {
        Get(<span class="hljs-string">&quot;/docs&quot;</span>, serverDocs)
        Get(<span class="hljs-string">&quot;/docs/*&quot;</span>, serverDocs)
    }
}
</code></pre>
<p><code>BeeApp.Run</code> &#x4E00;&#x53E5;&#x4E2D;&#x7684;BeeApp&#x6765;&#x81EA; <code>config.go</code> &#x6587;&#x4EF6;&#x7684; <code>init</code> &#x65B9;&#x6CD5;&#xFF0C;&#x8C03;&#x7528; <code>NewApp()</code> &#x6765;&#x521D;&#x59CB;&#x5316;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">// NewApp returns a new beego application.</span>
<span class="hljs-keyword">func</span> NewApp() *App {
   <span class="hljs-comment">// &#x8FD9;&#x73A9;&#x610F;&#x6BD4;&#x8F83;&#x5173;&#x952E;&#xFF0C;&#x6240;&#x6709;&#x7684;&#x8DEF;&#x7531;&#x5168;&#x5728;&#x91CC;&#x9762;&#x4E86;</span>
    cr := NewControllerRegister()
    app := &amp;App{Handlers: cr, Server: &amp;http.Server{}}
    <span class="hljs-keyword">return</span> app
}
</code></pre>
<p><code>BeeApp.Run</code> &#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">// Run beego application.</span>
<span class="hljs-keyword">func</span> (app *App) Run() {
    addr := HttpAddr

    <span class="hljs-keyword">if</span> HttpPort != <span class="hljs-number">0</span> {
        addr = fmt.Sprintf(<span class="hljs-string">&quot;%s:%d&quot;</span>, HttpAddr, HttpPort)
    }

    <span class="hljs-keyword">var</span> (
        err error
        l   net.Listener
    )
    endRunning := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-typename">bool</span>, <span class="hljs-number">1</span>)

   <span class="hljs-comment">// &#x4F7F;&#x7528;FastCGI&#x6765;&#x63D0;&#x4F9B;&#x670D;&#x52A1;</span>
    <span class="hljs-keyword">if</span> UseFcgi {
        <span class="hljs-keyword">if</span> UseStdIo {
            err = fcgi.Serve(<span class="hljs-constant">nil</span>, app.Handlers) <span class="hljs-comment">// standard I/O</span>
            <span class="hljs-keyword">if</span> err == <span class="hljs-constant">nil</span> {
                BeeLogger.Info(<span class="hljs-string">&quot;Use FCGI via standard I/O&quot;</span>)
            } <span class="hljs-keyword">else</span> {
                BeeLogger.Info(<span class="hljs-string">&quot;Cannot use FCGI via standard I/O&quot;</span>, err)
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> HttpPort == <span class="hljs-number">0</span> {
                <span class="hljs-comment">// remove the Socket file before start</span>
                <span class="hljs-keyword">if</span> utils.FileExists(addr) {
                    os.Remove(addr)
                }
                l, err = net.Listen(<span class="hljs-string">&quot;unix&quot;</span>, addr)
            } <span class="hljs-keyword">else</span> {
                l, err = net.Listen(<span class="hljs-string">&quot;tcp&quot;</span>, addr)
            }
            <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                BeeLogger.Critical(<span class="hljs-string">&quot;Listen: &quot;</span>, err)
            }
            err = fcgi.Serve(l, app.Handlers)
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// &#x4F18;&#x96C5;&#x5730;&#x542F;&#x52A8;&#x5173;&#x95ED;&#x670D;&#x52A1;</span>
        <span class="hljs-keyword">if</span> Graceful {
            app.Server.Addr = addr
            app.Server.Handler = app.Handlers
            app.Server.ReadTimeout = time.Duration(HttpServerTimeOut) * time.Second
            app.Server.WriteTimeout = time.Duration(HttpServerTimeOut) * time.Second
            <span class="hljs-keyword">if</span> EnableHttpTLS {
                <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
                    time.Sleep(<span class="hljs-number">20</span> * time.Microsecond)
                    <span class="hljs-keyword">if</span> HttpsPort != <span class="hljs-number">0</span> {
                        addr = fmt.Sprintf(<span class="hljs-string">&quot;%s:%d&quot;</span>, HttpAddr, HttpsPort)
                        app.Server.Addr = addr
                    }
                    <span class="hljs-comment">// &#x770B;&#x5230;app.Handlers&#x6CA1;&#xFF1F;</span>
                    server := grace.NewServer(addr, app.Handlers)
                    server.Server = app.Server
                    err := server.ListenAndServeTLS(HttpCertFile, HttpKeyFile)
                    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                        BeeLogger.Critical(<span class="hljs-string">&quot;ListenAndServeTLS: &quot;</span>, err, fmt.Sprintf(<span class="hljs-string">&quot;%d&quot;</span>, os.Getpid()))
                        time.Sleep(<span class="hljs-number">100</span> * time.Microsecond)
                        endRunning &lt;- <span class="hljs-constant">true</span>
                    }
                }()
            }
            <span class="hljs-keyword">if</span> EnableHttpListen {
                <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
                    <span class="hljs-comment">// &#x770B;&#x5230;&#x6CA1;&#xFF1F;</span>
                    server := grace.NewServer(addr, app.Handlers)
                    server.Server = app.Server
                    <span class="hljs-keyword">if</span> ListenTCP4 &amp;&amp; HttpAddr == <span class="hljs-string">&quot;&quot;</span> {
                        server.Network = <span class="hljs-string">&quot;tcp4&quot;</span>
                    }
                    err := server.ListenAndServe()
                    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                        BeeLogger.Critical(<span class="hljs-string">&quot;ListenAndServe: &quot;</span>, err, fmt.Sprintf(<span class="hljs-string">&quot;%d&quot;</span>, os.Getpid()))
                        time.Sleep(<span class="hljs-number">100</span> * time.Microsecond)
                        endRunning &lt;- <span class="hljs-constant">true</span>
                    }
                }()
            }
        } <span class="hljs-keyword">else</span> {
            app.Server.Addr = addr
            <span class="hljs-comment">//</span>
            app.Server.Handler = app.Handlers
            app.Server.ReadTimeout = time.Duration(HttpServerTimeOut) * time.Second
            app.Server.WriteTimeout = time.Duration(HttpServerTimeOut) * time.Second

            <span class="hljs-keyword">if</span> EnableHttpTLS {
                <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
                    time.Sleep(<span class="hljs-number">20</span> * time.Microsecond)
                    <span class="hljs-keyword">if</span> HttpsPort != <span class="hljs-number">0</span> {
                        app.Server.Addr = fmt.Sprintf(<span class="hljs-string">&quot;%s:%d&quot;</span>, HttpAddr, HttpsPort)
                    }
                    BeeLogger.Info(<span class="hljs-string">&quot;https server Running on %s&quot;</span>, app.Server.Addr)
                    err := app.Server.ListenAndServeTLS(HttpCertFile, HttpKeyFile)
                    <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                        BeeLogger.Critical(<span class="hljs-string">&quot;ListenAndServeTLS: &quot;</span>, err)
                        time.Sleep(<span class="hljs-number">100</span> * time.Microsecond)
                        endRunning &lt;- <span class="hljs-constant">true</span>
                    }
                }()
            }

            <span class="hljs-keyword">if</span> EnableHttpListen {
                <span class="hljs-keyword">go</span> <span class="hljs-keyword">func</span>() {
                    app.Server.Addr = addr
                    BeeLogger.Info(<span class="hljs-string">&quot;http server Running on %s&quot;</span>, app.Server.Addr)
                    <span class="hljs-keyword">if</span> ListenTCP4 &amp;&amp; HttpAddr == <span class="hljs-string">&quot;&quot;</span> {
                        ln, err := net.Listen(<span class="hljs-string">&quot;tcp4&quot;</span>, app.Server.Addr)
                        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                            BeeLogger.Critical(<span class="hljs-string">&quot;ListenAndServe: &quot;</span>, err)
                            time.Sleep(<span class="hljs-number">100</span> * time.Microsecond)
                            endRunning &lt;- <span class="hljs-constant">true</span>
                            <span class="hljs-keyword">return</span>
                        }
                        err = app.Server.Serve(ln)
                        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                            BeeLogger.Critical(<span class="hljs-string">&quot;ListenAndServe: &quot;</span>, err)
                            time.Sleep(<span class="hljs-number">100</span> * time.Microsecond)
                            endRunning &lt;- <span class="hljs-constant">true</span>
                            <span class="hljs-keyword">return</span>
                        }
                    } <span class="hljs-keyword">else</span> {
                        err := app.Server.ListenAndServe()
                        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                            BeeLogger.Critical(<span class="hljs-string">&quot;ListenAndServe: &quot;</span>, err)
                            time.Sleep(<span class="hljs-number">100</span> * time.Microsecond)
                            endRunning &lt;- <span class="hljs-constant">true</span>
                        }
                    }
                }()
            }
        }

    }
    &lt;-endRunning
}
</code></pre>
<p>&#x5BF9;&#x4E8E;&#x4E09;&#x79CD;&#x670D;&#x52A1;&#x542F;&#x52A8;&#x65B9;&#x5F0F;&#xFF0C;&#x8FD9;&#x4E09;&#x79CD;&#x65B9;&#x5F0F;&#x90FD;&#x8981;&#x6C42;<code>app.Handlers</code>&#x5B9E;&#x73B0;&#x4E86;<code>http.Handler</code>&#x63A5;&#x53E3;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> Handler <span class="hljs-keyword">interface</span> {
    ServeHTTP(ResponseWriter, *Request)
}
</code></pre>
<h1 id="%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86">&#x8BF7;&#x6C42;&#x5904;&#x7406;</h1>
<p>&#x63A5;&#x7740; <em>&#x542F;&#x52A8;&#x6D41;&#x7A0B;</em>&#xFF0C;&#x6765;&#x770B;&#x770B;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x6D41;&#x7A0B;&#x3002;</p>
<p><code>app.Handlers</code>&#x7684;&#x7C7B;&#x578B;&#x4E3A;&#xFF1A;<code>*ControllerRegistor</code>&#xFF0C;&#x5176;<code>ServeHTTP</code>&#x65B9;&#x6CD5;&#xFF0C;&#x4E5F;&#x5373;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x7684;&#x5165;&#x53E3;&#xFF0C;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">// Implement http.Handler interface.</span>
<span class="hljs-keyword">func</span> (p *ControllerRegistor) ServeHTTP(rw http.ResponseWriter, r *http.Request) {
   <span class="hljs-comment">// &#x8BF7;&#x6C42;&#x5904;&#x7406;&#x5F00;&#x59CB;&#x65F6;&#x95F4;</span>
    starttime := time.Now()
    <span class="hljs-keyword">var</span> runrouter reflect.Type
    <span class="hljs-keyword">var</span> findrouter <span class="hljs-typename">bool</span>
    <span class="hljs-keyword">var</span> runMethod <span class="hljs-typename">string</span>
    <span class="hljs-keyword">var</span> routerInfo *controllerInfo

   <span class="hljs-comment">// &#x5C06;http.ResponseWriter&#x5C01;&#x88C5;&#x6210;&#x81EA;&#x5DF1;&#x5B9A;&#x4E49;&#x7684;responseWriter&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x53EF;&#x4EE5;&#x5E72;&#x5F88;&#x591A;&#x4E8B;&#x60C5;&#x5566;&#xFF01;</span>
    w := &amp;responseWriter{writer: rw}

   <span class="hljs-comment">// &#x5728;dev&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;&#x4F1A;&#x5728;&#x54CD;&#x5E94;&#x5934;&#x4E2D;&#x52A0;Server&#x5B57;&#x6BB5;</span>
    <span class="hljs-keyword">if</span> RunMode == <span class="hljs-string">&quot;dev&quot;</span> {
        w.Header().Set(<span class="hljs-string">&quot;Server&quot;</span>, BeegoServerName)
    }

   <span class="hljs-comment">// &#x8BF7;&#x6C42;&#x5904;&#x7406;&#x4E0A;&#x4E0B;&#x6587;</span>
    <span class="hljs-comment">// init context</span>
    context := &amp;beecontext.Context{
        ResponseWriter: w,
        Request:        r,
        Input:          beecontext.NewInput(r),
        Output:         beecontext.NewOutput(),
    }
    context.Output.Context = context
    context.Output.EnableGzip = EnableGzip

   <span class="hljs-comment">// &#x5904;&#x7406;&#x51FA;&#x9519;&#x65F6;&#xFF0C;&#x4EA4;&#x7ED9;recoverPanic&#x6765;&#x505A;&#x9519;&#x8BEF;&#x5904;&#x7406;&#xFF0C;&#x5E76;&#x54CD;&#x5E94;</span>
   <span class="hljs-comment">// &#x8FD8;&#x8BB0;&#x5F97; **&#x542F;&#x52A8;&#x6D41;&#x7A0B;** &#x4E2D;&#x7684; registerDefaultErrorHandler() &#x5417;&#xFF1F;</span>
    <span class="hljs-keyword">defer</span> p.recoverPanic(context)

    <span class="hljs-keyword">var</span> urlPath <span class="hljs-typename">string</span>
    <span class="hljs-comment">// &#x5982;&#x679C;&#x914D;&#x7F6E;&#x8BF7;&#x6C42;&#x8DEF;&#x5F84;&#x5927;&#x5C0F;&#x5199;&#x4E0D;&#x654F;&#x611F;&#xFF0C;&#x5219;&#x7EDF;&#x4E00;&#x8F6C;&#x6210;&#x5C0F;&#x5199;</span>
    <span class="hljs-keyword">if</span> !RouterCaseSensitive {
        urlPath = strings.ToLower(r.URL.Path)
    } <span class="hljs-keyword">else</span> {
        urlPath = r.URL.Path
    }
    <span class="hljs-comment">// defined filter function</span>
    <span class="hljs-comment">// &#x7528;&#x4E8E;&#x6267;&#x884C;&#x4E0D;&#x540C;&#x9636;&#x6BB5;&#x7684;&#x8FC7;&#x6EE4;&#x5668;</span>
    <span class="hljs-comment">// pos &#x53C2;&#x6570;&#x5C31;&#x662F;&#x6307;&#x201C;&#x9636;&#x6BB5;&#x201D;</span>
    do_filter := <span class="hljs-keyword">func</span>(pos <span class="hljs-typename">int</span>) (started <span class="hljs-typename">bool</span>) {
        <span class="hljs-keyword">if</span> p.enableFilter {
            <span class="hljs-comment">// &#x53BB;&#x9664;&#x8BE5;&#x9636;&#x6BB5;&#x7684;&#x8FC7;&#x6EE4;&#x5668;&#x5217;&#x8868;</span>
            <span class="hljs-keyword">if</span> l, ok := p.filters[pos]; ok {
                <span class="hljs-keyword">for</span> _, filterR := <span class="hljs-keyword">range</span> l {
                    <span class="hljs-keyword">if</span> filterR.returnOnOutput &amp;&amp; w.started {
                        <span class="hljs-keyword">return</span> <span class="hljs-constant">true</span>
                    }
                    <span class="hljs-comment">// &#x53EF;&#x4EE5;&#x770B;&#x51FA;&#x8FC7;&#x6EE4;&#x5668;&#x9700;&#x8981;&#x5B9E;&#x73B0;ValidRouter</span>
                    <span class="hljs-comment">// &#x9A8C;&#x8BC1;URL&#x8DEF;&#x5F84;&#x5E76;&#x8FD4;&#x56DE;&#x5176;&#x4E2D;&#x7684;URL&#x53C2;&#x6570;</span>
                    <span class="hljs-keyword">if</span> ok, params := filterR.ValidRouter(urlPath); ok {
                        <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> params {
                            <span class="hljs-keyword">if</span> context.Input.Params == <span class="hljs-constant">nil</span> {
                                context.Input.Params = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-typename">string</span>]<span class="hljs-typename">string</span>)
                            }
                            context.Input.Params[k] = v
                        }
                        <span class="hljs-comment">// filterFunc</span>
                        <span class="hljs-comment">// &#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x8BE5;&#x600E;&#x4E48;&#x5B9E;&#x73B0;&#x5462;&#xFF1F;</span>
                        filterR.filterFunc(context)
                    }
                    <span class="hljs-comment">// &#x5982;&#x679C;&#x8FC7;&#x6EE4;&#x5668;&#x76F4;&#x63A5;&#x5C31;&#x5904;&#x7406;&#x4E86;&#x8BF7;&#x6C42;&#x5E76;&#x4F5C;&#x51FA;&#x54CD;&#x5E94;</span>
                    <span class="hljs-keyword">if</span> filterR.returnOnOutput &amp;&amp; w.started {
                        <span class="hljs-keyword">return</span> <span class="hljs-constant">true</span>
                    }
                }
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-constant">false</span>
    }

    <span class="hljs-comment">// filter wrong httpmethod</span>
    <span class="hljs-comment">// &#x5F53;&#x524D;HTTP&#x8BF7;&#x6C42;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x652F;&#x6301;&#xFF1F;</span>
    <span class="hljs-keyword">if</span> _, ok := HTTPMETHOD[r.Method]; !ok {
        http.Error(w, <span class="hljs-string">&quot;Method Not Allowed&quot;</span>, <span class="hljs-number">405</span>)
        <span class="hljs-comment">// &#x53BB;Admin&#x8BB0;&#x5F55;&#x4E00;&#x4E0B;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x7684;&#x4FE1;&#x606F;</span>
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-comment">// filter for static file</span>
    <span class="hljs-comment">// &#x5728;&#x5904;&#x7406;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8BF7;&#x6C42;&#x4E4B;&#x524D;&#x6267;&#x884C;&#x8BE5;&#x9636;&#x6BB5;&#x7684;&#x8FC7;&#x6EE4;&#x5668;</span>
    <span class="hljs-keyword">if</span> do_filter(BeforeStatic) {
        <span class="hljs-keyword">goto</span> Admin
    }

   <span class="hljs-comment">// &#x5C1D;&#x8BD5;&#x5904;&#x7406;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8BF7;&#x6C42;</span>
    serverStaticRouter(context)
    <span class="hljs-comment">// &#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x7684;&#x53EF;&#x80FD;&#x786E;&#x5B9E;&#x662F;&#x4E2A;&#x9759;&#x6001;&#x6587;&#x4EF6;&#xFF0C;&#x6240;&#x4EE5;&#x5728;serverStaticRouter&#x4E2D;&#x5DF2;&#x7ECF;&#x505A;&#x51FA;&#x4E86;&#x54CD;&#x5E94;</span>
    <span class="hljs-keyword">if</span> w.started {
        <span class="hljs-comment">// &#x90A3;&#x4E48;&#x4EE5;&#x4E0B;&#x4E5F;&#x5C31;&#x4E0D;&#x7528;&#x518D;&#x63A5;&#x7740;&#x53BB;&#x67E5;&#x627E;&#x975E;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7684;&#x8DEF;&#x7531;&#x4E86;</span>
        findrouter = <span class="hljs-constant">true</span>
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-comment">// session init</span>
    <span class="hljs-comment">// &#x5F00;&#x542F;session</span>
    <span class="hljs-keyword">if</span> SessionOn {
        <span class="hljs-keyword">var</span> err error
        context.Input.CruSession, err = GlobalSessions.SessionStart(w, r)
        <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
            Error(err)
            exception(<span class="hljs-string">&quot;503&quot;</span>, context)
            <span class="hljs-keyword">return</span>
        }
        <span class="hljs-comment">// &#x5F97;&#x8BB0;&#x5F97;&#x91CA;&#x653E;&#x5440;</span>
        <span class="hljs-keyword">defer</span> <span class="hljs-keyword">func</span>() {
            context.Input.CruSession.SessionRelease(w)
        }()
    }

    <span class="hljs-comment">// &#x89E3;&#x6790;&#x8BF7;&#x6C42;&#x4F53;</span>
    <span class="hljs-keyword">if</span> r.Method != <span class="hljs-string">&quot;GET&quot;</span> &amp;&amp; r.Method != <span class="hljs-string">&quot;HEAD&quot;</span> {
        <span class="hljs-keyword">if</span> CopyRequestBody &amp;&amp; !context.Input.IsUpload() {
            context.Input.CopyBody()
        }
        context.Input.ParseFormOrMulitForm(MaxMemory)
    }
    <span class="hljs-comment">// &#x6267;&#x884C;&#x8DEF;&#x7531;&#x67E5;&#x627E;&#x524D;&#x7684;&#x8FC7;&#x6EE4;&#x5668;</span>
    <span class="hljs-keyword">if</span> do_filter(BeforeRouter) {
        <span class="hljs-keyword">goto</span> Admin
    }

   <span class="hljs-comment">// &#x63A5;&#x4E0B;&#x6765;&#x8981;&#x67E5;&#x627E;&#x5339;&#x914D;&#x8DEF;&#x7531;&#x4E86;</span>
   <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6761;&#x4EF6;&#x4F1A;&#x4E3A;&#x771F;&#x5462;&#xFF1F;</span>
    <span class="hljs-keyword">if</span> context.Input.RunController != <span class="hljs-constant">nil</span> &amp;&amp; context.Input.RunMethod != <span class="hljs-string">&quot;&quot;</span> {
        findrouter = <span class="hljs-constant">true</span>
        runMethod = context.Input.RunMethod
        runrouter = context.Input.RunController
    }

    <span class="hljs-keyword">if</span> !findrouter {
        http_method := r.Method

       <span class="hljs-comment">// PUT&#x3001;DELETE &#x517C;&#x5BB9;&#x65B9;&#x6848;</span>
        <span class="hljs-keyword">if</span> http_method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;PUT&quot;</span> {
            http_method = <span class="hljs-string">&quot;PUT&quot;</span>
        }

        <span class="hljs-keyword">if</span> http_method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;DELETE&quot;</span> {
            http_method = <span class="hljs-string">&quot;DELETE&quot;</span>
        }

       <span class="hljs-comment">//</span>
        <span class="hljs-keyword">if</span> t, ok := p.routers[http_method]; ok {
           <span class="hljs-comment">// &#x5982;&#x4F55;&#x5339;&#x914D;&#x7684;&#xFF1F;</span>
            runObject, p := t.Match(urlPath)
            <span class="hljs-comment">// &#x8FD9;&#x91CC;&#x8C8C;&#x4F3C;&#x5F88;&#x725B;&#x903C;&#x7684;&#x6837;&#x5B50;</span>
            <span class="hljs-keyword">if</span> r, ok := runObject.(*controllerInfo); ok {
                routerInfo = r
                findrouter = <span class="hljs-constant">true</span>
                <span class="hljs-keyword">if</span> splat, ok := p[<span class="hljs-string">&quot;:splat&quot;</span>]; ok {
                    splatlist := strings.Split(splat, <span class="hljs-string">&quot;/&quot;</span>)
                    <span class="hljs-keyword">for</span> k, v := <span class="hljs-keyword">range</span> splatlist {
                        p[strconv.Itoa(k)] = v
                    }
                }
                <span class="hljs-keyword">if</span> p != <span class="hljs-constant">nil</span> {
                    context.Input.Params = p
                }
            }
        }

    }

    <span class="hljs-comment">//if no matches to url, throw a not found exception</span>
    <span class="hljs-keyword">if</span> !findrouter {
        exception(<span class="hljs-string">&quot;404&quot;</span>, context)
        <span class="hljs-keyword">goto</span> Admin
    }

    <span class="hljs-keyword">if</span> findrouter {
        <span class="hljs-comment">//execute middleware filters</span>
        <span class="hljs-keyword">if</span> do_filter(BeforeExec) {
            <span class="hljs-keyword">goto</span> Admin
        }
        isRunable := <span class="hljs-constant">false</span>
        <span class="hljs-keyword">if</span> routerInfo != <span class="hljs-constant">nil</span> {
            <span class="hljs-comment">// RESTful&#x98CE;&#x683C;&#x7684;&#x8DEF;&#x7531;</span>
            <span class="hljs-keyword">if</span> routerInfo.routerType == routerTypeRESTFul {
                <span class="hljs-keyword">if</span> _, ok := routerInfo.methods[r.Method]; ok {
                    isRunable = <span class="hljs-constant">true</span>
                    routerInfo.runfunction(context)
                } <span class="hljs-keyword">else</span> {
                    exception(<span class="hljs-string">&quot;405&quot;</span>, context)
                    <span class="hljs-keyword">goto</span> Admin
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> routerInfo.routerType == routerTypeHandler {
                <span class="hljs-comment">// &#x8FD9;&#x662F;&#x5565;&#x98CE;&#x683C;&#xFF1F;</span>
                isRunable = <span class="hljs-constant">true</span>
                routerInfo.handler.ServeHTTP(rw, r)
            } <span class="hljs-keyword">else</span> {
                runrouter = routerInfo.controllerType
                method := r.Method
                <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;PUT&quot;</span> {
                    method = <span class="hljs-string">&quot;PUT&quot;</span>
                }
                <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;DELETE&quot;</span> {
                    method = <span class="hljs-string">&quot;DELETE&quot;</span>
                }
                <span class="hljs-keyword">if</span> m, ok := routerInfo.methods[method]; ok {
                    runMethod = m
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> m, ok = routerInfo.methods[<span class="hljs-string">&quot;*&quot;</span>]; ok {
                    runMethod = m
                } <span class="hljs-keyword">else</span> {
                    runMethod = method
                }
            }
        }

        <span class="hljs-comment">// also defined runrouter &amp; runMethod from filter</span>
        <span class="hljs-keyword">if</span> !isRunable {
            <span class="hljs-comment">//Invoke the request handler</span>
            vc := reflect.New(runrouter)
            execController, ok := vc.Interface().(ControllerInterface)
            <span class="hljs-keyword">if</span> !ok {
                <span class="hljs-built_in">panic</span>(<span class="hljs-string">&quot;controller is not ControllerInterface&quot;</span>)
            }

            <span class="hljs-comment">//call the controller init function</span>
            execController.Init(context, runrouter.Name(), runMethod, vc.Interface())

            <span class="hljs-comment">//call prepare function</span>
            execController.Prepare()

            <span class="hljs-comment">//if XSRF is Enable then check cookie where there has any cookie in the  request&apos;s cookie _csrf</span>
            <span class="hljs-keyword">if</span> EnableXSRF {
                execController.XsrfToken()
                <span class="hljs-keyword">if</span> r.Method == <span class="hljs-string">&quot;POST&quot;</span> || r.Method == <span class="hljs-string">&quot;DELETE&quot;</span> || r.Method == <span class="hljs-string">&quot;PUT&quot;</span> ||
                    (r.Method == <span class="hljs-string">&quot;POST&quot;</span> &amp;&amp; (context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;DELETE&quot;</span> || context.Input.Query(<span class="hljs-string">&quot;_method&quot;</span>) == <span class="hljs-string">&quot;PUT&quot;</span>)) {
                    execController.CheckXsrfCookie()
                }
            }

            execController.URLMapping()

            <span class="hljs-keyword">if</span> !w.started {
                <span class="hljs-comment">//exec main logic</span>
                <span class="hljs-keyword">switch</span> runMethod {
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;GET&quot;</span>:
                    execController.Get()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;POST&quot;</span>:
                    execController.Post()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;DELETE&quot;</span>:
                    execController.Delete()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;PUT&quot;</span>:
                    execController.Put()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;HEAD&quot;</span>:
                    execController.Head()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;PATCH&quot;</span>:
                    execController.Patch()
                <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;OPTIONS&quot;</span>:
                    execController.Options()
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">if</span> !execController.HandlerFunc(runMethod) {
                        in := <span class="hljs-built_in">make</span>([]reflect.Value, <span class="hljs-number">0</span>)
                        method := vc.MethodByName(runMethod)
                        method.Call(in)
                    }
                }

                <span class="hljs-comment">//render template</span>
                <span class="hljs-keyword">if</span> !w.started &amp;&amp; context.Output.Status == <span class="hljs-number">0</span> {
                    <span class="hljs-comment">// AutoRender &#x9ED8;&#x8BA4;&#x4E3A; true</span>
                    <span class="hljs-keyword">if</span> AutoRender {
                        <span class="hljs-keyword">if</span> err := execController.Render(); err != <span class="hljs-constant">nil</span> {
                            <span class="hljs-built_in">panic</span>(err)
                        }
                    }
                }
            }

            <span class="hljs-comment">// finish all runrouter. release resource</span>
            execController.Finish()
        }

        <span class="hljs-comment">//execute middleware filters</span>
        <span class="hljs-keyword">if</span> do_filter(AfterExec) {
            <span class="hljs-keyword">goto</span> Admin
        }
    }

    do_filter(FinishRouter)

Admin:
    timeend := time.Since(starttime)
    <span class="hljs-comment">//admin module record QPS</span>
    <span class="hljs-keyword">if</span> EnableAdmin {
        <span class="hljs-keyword">if</span> FilterMonitorFunc(r.Method, r.URL.Path, timeend) {
            <span class="hljs-keyword">if</span> runrouter != <span class="hljs-constant">nil</span> {
                <span class="hljs-keyword">go</span> toolbox.StatisticsMap.AddStatistics(r.Method, r.URL.Path, runrouter.Name(), timeend)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">go</span> toolbox.StatisticsMap.AddStatistics(r.Method, r.URL.Path, <span class="hljs-string">&quot;&quot;</span>, timeend)
            }
        }
    }

    <span class="hljs-keyword">if</span> RunMode == <span class="hljs-string">&quot;dev&quot;</span> || AccessLogs {
        <span class="hljs-keyword">var</span> devinfo <span class="hljs-typename">string</span>
        <span class="hljs-keyword">if</span> findrouter {
            <span class="hljs-keyword">if</span> routerInfo != <span class="hljs-constant">nil</span> {
                devinfo = fmt.Sprintf(<span class="hljs-string">&quot;| % -10s | % -40s | % -16s | % -10s | % -40s |&quot;</span>, r.Method, r.URL.Path, timeend.String(), <span class="hljs-string">&quot;match&quot;</span>, routerInfo.pattern)
            } <span class="hljs-keyword">else</span> {
                devinfo = fmt.Sprintf(<span class="hljs-string">&quot;| % -10s | % -40s | % -16s | % -10s |&quot;</span>, r.Method, r.URL.Path, timeend.String(), <span class="hljs-string">&quot;match&quot;</span>)
            }
        } <span class="hljs-keyword">else</span> {
            devinfo = fmt.Sprintf(<span class="hljs-string">&quot;| % -10s | % -40s | % -16s | % -10s |&quot;</span>, r.Method, r.URL.Path, timeend.String(), <span class="hljs-string">&quot;notmatch&quot;</span>)
        }
        <span class="hljs-keyword">if</span> DefaultLogFilter == <span class="hljs-constant">nil</span> || !DefaultLogFilter.Filter(context) {
            Debug(devinfo)
        }
    }

    <span class="hljs-comment">// Call WriteHeader if status code has been set changed</span>
    <span class="hljs-keyword">if</span> context.Output.Status != <span class="hljs-number">0</span> {
        w.writer.WriteHeader(context.Output.Status)
    }
}
</code></pre>
<hr>
<p>&#x4E0A;&#x8FF0;&#x4EE3;&#x7801;&#x4E2D;&#x4F7F;&#x7528;&#x4E86; <code>responseWriter</code>&#xFF0C;&#x5176;&#x5B9A;&#x4E49;&#x5982;&#x4E0B;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">//responseWriter is a wrapper for the http.ResponseWriter</span>
<span class="hljs-comment">//started set to true if response was written to then don&apos;t execute other handler</span>
<span class="hljs-keyword">type</span> responseWriter <span class="hljs-keyword">struct</span> {
    writer  http.ResponseWriter
    started <span class="hljs-typename">bool</span>
    status  <span class="hljs-typename">int</span>
}
</code></pre>
<hr>
<p>&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8BF7;&#x6C42;&#x5904;&#x7406;&#x51FD;&#x6570; <code>serverStaticRouter</code> &#x5B9A;&#x4E49;&#x5728;&#x6587;&#x4EF6; <code>staticfile.go</code>&#x4E2D;&#xFF0C;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-keyword">func</span> serverStaticRouter(ctx *context.Context) {
   <span class="hljs-comment">// &#x975E;GET/HEAD&#x65B9;&#x6CD5;&#x7684;&#x8BF7;&#x6C42;&#x4E0D;&#x8BA4;&#x4E3A;&#x662F;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8BF7;&#x6C42;</span>
    <span class="hljs-keyword">if</span> ctx.Input.Method() != <span class="hljs-string">&quot;GET&quot;</span> &amp;&amp; ctx.Input.Method() != <span class="hljs-string">&quot;HEAD&quot;</span> {
        <span class="hljs-keyword">return</span>
    }
    <span class="hljs-comment">// &#x4E3A;&#x6BDB;&#x4E0D;&#x76F4;&#x63A5;&#x4F7F;&#x7528; ctx.Request.URL.Path?</span>
    requestPath := path.Clean(ctx.Input.Request.URL.Path)
    i := <span class="hljs-number">0</span>
    <span class="hljs-comment">// &#x904D;&#x5386;&#x914D;&#x7F6E;&#x7684;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x76EE;&#x5F55;&#xFF0C;prefix&#x8868;&#x793A;URL&#x524D;&#x7F00;&#xFF0C;&#x5373;&#x5728;Beego&#x4E2D;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x591A;&#x4E2A; prefix =&gt; staticDir &#x5BF9;</span>
    <span class="hljs-keyword">for</span> prefix, staticDir := <span class="hljs-keyword">range</span> StaticDir {
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(prefix) == <span class="hljs-number">0</span> {
            <span class="hljs-keyword">continue</span>
        }
        <span class="hljs-comment">// &#x8FD9;&#x4E24;&#x4E2A;&#x6587;&#x4EF6;&#x6BD4;&#x8F83;&#x7279;&#x6B8A;&#xFF0C;&#x6240;&#x4EE5;&#x7279;&#x6B8A;&#x5904;&#x7406;</span>
        <span class="hljs-keyword">if</span> requestPath == <span class="hljs-string">&quot;/favicon.ico&quot;</span> || requestPath == <span class="hljs-string">&quot;/robots.txt&quot;</span> {
            file := path.Join(staticDir, requestPath)
            <span class="hljs-keyword">if</span> utils.FileExists(file) {
                <span class="hljs-comment">// </span>
                http.ServeFile(ctx.ResponseWriter, ctx.Request, file)
                <span class="hljs-keyword">return</span>
            } <span class="hljs-keyword">else</span> {
                i++
                <span class="hljs-keyword">if</span> i == <span class="hljs-built_in">len</span>(StaticDir) {
                    http.NotFound(ctx.ResponseWriter, ctx.Request)
                    <span class="hljs-keyword">return</span>
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">continue</span>
                }
            }
        }
        <span class="hljs-keyword">if</span> strings.HasPrefix(requestPath, prefix) {
            <span class="hljs-comment">// &#x4EC5;&#x4EC5;&#x662F;&#x8DEF;&#x5F84;&#x5B57;&#x7B26;&#x4E32;&#x524D;&#x7F00;&#x8FD8;&#x662F;&#x4E0D;&#x591F;&#x7684;!</span>
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(requestPath) &gt; <span class="hljs-built_in">len</span>(prefix) &amp;&amp; requestPath[<span class="hljs-built_in">len</span>(prefix)] != <span class="hljs-string">&apos;/&apos;</span> {
                <span class="hljs-keyword">continue</span>
            }
            <span class="hljs-comment">// &#x62FC;&#x63A5;&#x51FA;&#x76EE;&#x6807;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x8DEF;&#x5F84;</span>
            file := path.Join(staticDir, requestPath[<span class="hljs-built_in">len</span>(prefix):])
            finfo, err := os.Stat(file)
            <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                <span class="hljs-keyword">if</span> RunMode == <span class="hljs-string">&quot;dev&quot;</span> {
                    Warn(<span class="hljs-string">&quot;Can&apos;t find the file:&quot;</span>, file, err)
                }
                http.NotFound(ctx.ResponseWriter, ctx.Request)
                <span class="hljs-keyword">return</span>
            }
            <span class="hljs-comment">//if the request is dir and DirectoryIndex is false then</span>
            <span class="hljs-comment">// &#x5982;&#x679C;&#x662F;&#x76EE;&#x5F55;&#x7684;&#x8BDD;,&#x770B;&#x770B;&#x662F;&#x5426;&#x5141;&#x8BB8;&#x7F57;&#x5217;&#x51FA;&#x76EE;&#x5F55;&#x7684;&#x5185;&#x5BB9;</span>
            <span class="hljs-keyword">if</span> finfo.IsDir() {
                <span class="hljs-keyword">if</span> !DirectoryIndex {
                    exception(<span class="hljs-string">&quot;403&quot;</span>, ctx)
                    <span class="hljs-keyword">return</span>
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ctx.Input.Request.URL.Path[<span class="hljs-built_in">len</span>(ctx.Input.Request.URL.Path)-<span class="hljs-number">1</span>] != <span class="hljs-string">&apos;/&apos;</span> {
                    http.Redirect(ctx.ResponseWriter, ctx.Request, ctx.Input.Request.URL.Path+<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-number">302</span>)
                    <span class="hljs-keyword">return</span>
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> strings.HasSuffix(requestPath, <span class="hljs-string">&quot;/index.html&quot;</span>) {
                file := path.Join(staticDir, requestPath)
                <span class="hljs-keyword">if</span> utils.FileExists(file) {
                    http.ServeFile(ctx.ResponseWriter, ctx.Request, file)
                    <span class="hljs-keyword">return</span>
                }
            }

            <span class="hljs-comment">//This block obtained from (https://github.com/smithfox/beego) - it should probably get merged into astaxie/beego after a pull request</span>
            <span class="hljs-comment">// &#x68C0;&#x6D4B;&#x5F53;&#x524D;&#x9759;&#x6001;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x662F;&#x5426;&#x9700;&#x8981;&#x538B;&#x7F29;&#x540E;&#x4F20;&#x8F93;</span>
            <span class="hljs-comment">// &#x4E0D;&#x8FC7;&#x6211;&#x4E0D;&#x592A;&#x559C;&#x6B22;&#x904D;&#x5386;&#x7684;&#x65B9;&#x5F0F;,&#x6211;&#x66F4;&#x559C;&#x6B22;map</span>
            isStaticFileToCompress := <span class="hljs-constant">false</span>
            <span class="hljs-keyword">if</span> StaticExtensionsToGzip != <span class="hljs-constant">nil</span> &amp;&amp; <span class="hljs-built_in">len</span>(StaticExtensionsToGzip) &gt; <span class="hljs-number">0</span> {
                <span class="hljs-keyword">for</span> _, statExtension := <span class="hljs-keyword">range</span> StaticExtensionsToGzip {
                    <span class="hljs-keyword">if</span> strings.HasSuffix(strings.ToLower(file), strings.ToLower(statExtension)) {
                        isStaticFileToCompress = <span class="hljs-constant">true</span>
                        <span class="hljs-keyword">break</span>
                    }
                }
            }

            <span class="hljs-keyword">if</span> isStaticFileToCompress {
                <span class="hljs-keyword">var</span> contentEncoding <span class="hljs-typename">string</span>
                <span class="hljs-keyword">if</span> EnableGzip {
                   <span class="hljs-comment">// &#x6839;&#x636E;&#x8BF7;&#x6C42;&#x5934;Accept-Encoding&#x6765;&#x5224;&#x65AD;&#x538B;&#x7F29;&#x65B9;&#x5F0F;</span>
                    contentEncoding = getAcceptEncodingZip(ctx.Request)
                }
             <span class="hljs-comment">// &#x5982;&#x679C;&#x80FD;&#x6D41;&#x5F0F;&#x5730;&#x54CD;&#x5E94;&#x5C31;&#x66F4;&#x68D2;&#x4E86;&#xFF01;</span>
                memzipfile, err := openMemZipFile(file, contentEncoding)
                <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                    <span class="hljs-keyword">return</span>
                }

                <span class="hljs-keyword">if</span> contentEncoding == <span class="hljs-string">&quot;gzip&quot;</span> {
                    ctx.Output.Header(<span class="hljs-string">&quot;Content-Encoding&quot;</span>, <span class="hljs-string">&quot;gzip&quot;</span>)
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> contentEncoding == <span class="hljs-string">&quot;deflate&quot;</span> {
                    ctx.Output.Header(<span class="hljs-string">&quot;Content-Encoding&quot;</span>, <span class="hljs-string">&quot;deflate&quot;</span>)
                } <span class="hljs-keyword">else</span> {
                    ctx.Output.Header(<span class="hljs-string">&quot;Content-Length&quot;</span>, strconv.FormatInt(finfo.Size(), <span class="hljs-number">10</span>))
                }

             <span class="hljs-comment">// http.ServeContent</span>
                http.ServeContent(ctx.ResponseWriter, ctx.Request, file, finfo.ModTime(), memzipfile)

            } <span class="hljs-keyword">else</span> {
                http.ServeFile(ctx.ResponseWriter, ctx.Request, file)
            }
            <span class="hljs-keyword">return</span>
        }
    }
}
</code></pre>
<hr>
<p>&#x5F00;&#x542F;session&#x7684; <code>context.Input.CruSession, err = GlobalSessions.SessionStart(w, r)</code> &#x4E00;&#x884C;&#x4E2D;&#x7684; <code>GlobalSessions</code> &#x60F3;&#x5FC5;&#x8FD8;&#x8BB0;&#x5F97;&#x5427;&#xFF1F;&#x5728;<strong>&#x542F;&#x52A8;&#x6D41;&#x7A0B;</strong>&#x4E2D;&#x6709; <code>GlobalSessions, err = session.NewManager(SessionProvider, sessionConfig)</code> &#x4E00;&#x884C;&#x3002; <code>GlobalSessions.SessionStart</code> &#x65B9;&#x6CD5;&#x5B9E;&#x73B0;&#x5982;&#x4E0B;&#x6240;&#x793A;&#xFF1A;</p>
<pre><code class="lang-go"><span class="hljs-comment">// Start session. generate or read the session id from http request.</span>
<span class="hljs-comment">// if session id exists, return SessionStore with this id.</span>
<span class="hljs-keyword">func</span> (manager *Manager) SessionStart(w http.ResponseWriter, r *http.Request) (session SessionStore, err error) {
   <span class="hljs-comment">// &#x770B;&#x770B;&#x8BF7;&#x6C42;&#x5934;&#x4E2D;&#x662F;&#x5426;&#x6709;session id&#x7684;cookie</span>
    cookie, errs := r.Cookie(manager.config.CookieName)
    <span class="hljs-keyword">if</span> errs != <span class="hljs-constant">nil</span> || cookie.Value == <span class="hljs-string">&quot;&quot;</span> {
       <span class="hljs-comment">// &#x6CA1;&#x6709;&#x5219;&#x65B0;&#x751F;&#x6210;&#x4E00;&#x4E2A;</span>
        sid, errs := manager.sessionId(r)
        <span class="hljs-keyword">if</span> errs != <span class="hljs-constant">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, errs
        }
        session, err = manager.provider.SessionRead(sid)
        cookie = &amp;http.Cookie{
            Name:     manager.config.CookieName,
            Value:    url.QueryEscape(sid),
            Path:     <span class="hljs-string">&quot;/&quot;</span>,
            HttpOnly: <span class="hljs-constant">true</span>,
            Secure:   manager.isSecure(r),
            Domain:   manager.config.Domain,
        }
        <span class="hljs-keyword">if</span> manager.config.CookieLifeTime &gt; <span class="hljs-number">0</span> {
            cookie.MaxAge = manager.config.CookieLifeTime
            cookie.Expires = time.Now().Add(time.Duration(manager.config.CookieLifeTime) * time.Second)
        }
        <span class="hljs-keyword">if</span> manager.config.EnableSetCookie {
            http.SetCookie(w, cookie)
        }
        r.AddCookie(cookie)
    } <span class="hljs-keyword">else</span> {
       <span class="hljs-comment">// &#x6709;&#xFF0C;&#x5219;&#x53D6;&#x51FA;&#x76EE;&#x6807;session id&#xFF0C;&#x63A5;&#x7740;&#x8BFB;&#x53D6;session&#x6570;&#x636E;</span>
        sid, errs := url.QueryUnescape(cookie.Value)
        <span class="hljs-keyword">if</span> errs != <span class="hljs-constant">nil</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, errs
        }
        <span class="hljs-comment">// &#x4F46;&#x53EF;&#x80FD;&#x76EE;&#x6807;session&#x5DF2;&#x7ECF;&#x8FC7;&#x671F;&#xFF0C;&#x4E0D;&#x5B58;&#x5728;&#x4E86;&#xFF0C;&#x5219;&#x4E5F;&#x81EA;&#x52A8;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x65B0;&#x7684;</span>
        <span class="hljs-keyword">if</span> manager.provider.SessionExist(sid) {
            session, err = manager.provider.SessionRead(sid)
        } <span class="hljs-keyword">else</span> {
           <span class="hljs-comment">// &#x8FD9;&#x4EE3;&#x7801;&#x62F7;&#x8D1D;&#x5F97;&#x8BA9;&#x6211;&#x6709;&#x4E9B;&#x4E0D;&#x723D;&#x5440;</span>
            sid, err = manager.sessionId(r)
            <span class="hljs-keyword">if</span> err != <span class="hljs-constant">nil</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-constant">nil</span>, err
            }
            session, err = manager.provider.SessionRead(sid)
            cookie = &amp;http.Cookie{
                Name:     manager.config.CookieName,
                Value:    url.QueryEscape(sid),
                Path:     <span class="hljs-string">&quot;/&quot;</span>,
                HttpOnly: <span class="hljs-constant">true</span>,
                Secure:   manager.isSecure(r),
                Domain:   manager.config.Domain,
            }
            <span class="hljs-keyword">if</span> manager.config.CookieLifeTime &gt; <span class="hljs-number">0</span> {
                cookie.MaxAge = manager.config.CookieLifeTime
                cookie.Expires = time.Now().Add(time.Duration(manager.config.CookieLifeTime) * time.Second)
            }
            <span class="hljs-comment">// &#x8FD9;&#x662F;&#x5565;&#x610F;&#x601D;&#xFF1F;</span>
            <span class="hljs-keyword">if</span> manager.config.EnableSetCookie {
                http.SetCookie(w, cookie)
            }
            r.AddCookie(cookie)
        }
    }
    <span class="hljs-keyword">return</span>
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../language/go/learning-go.html" class="navigation navigation-prev " aria-label="Previous page: 读书笔记：Go学习笔记"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../language/js.html" class="navigation navigation-next " aria-label="Next page: JavaScript"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
