

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How Do I Use Salt States? &mdash; xiayf的学习笔记</title>
  

  
  

  
  <link href="../../static/css/google-fonts.css" rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="xiayf的学习笔记" href="../../index.html"/>
        <link rel="up" title="SaltStack" href="../saltstack.html"/>
        <link rel="next" title="Pillar Walkthrough" href="pillar_walkthrough.html"/>
        <link rel="prev" title="SaltStack" href="../saltstack.html"/> 

  
  <script src="../../static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="fa fa-home"> 学习笔记</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/read_high_scalability.html">High Scalability 读文笔记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/read_high_scalability.html#tumblr">Tumblr架构设计</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/Quora_technology_examined.html">读文笔记：Quora’s Technology Examined</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#the-search-box">The Search-Box</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#webnode2-and-livenode">Webnode2 And LiveNode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#amazon-web-services">Amazon Web Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#haproxy-load-balancing">HAProxy Load-Balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#nginx">Nginx</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#pylons-and-paste">Pylons And Paste</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#python">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#thrift">Thrift</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#tornado">Tornado</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#long-polling-comet">Long Polling (Comet)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#mysql">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#memcached">Memcached</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#git">Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#javascript-placement">JavaScript Placement</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/Quora_technology_examined.html#charlie-cheever-follows-14-rules-for-faster-loading-web-sites">Charlie Cheever Follows &#8220;14 Rules for Faster-Loading Web Sites&#8221;</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/reference.html">参考资料</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#id2">知乎</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#netflix">Netflix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#linkedin">LinkedIn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#pinterest">Pinterest</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#google">Google</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#id5">大众点评网</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#id7">阿里巴巴</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#digg">Digg</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#heroku">Heroku</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#youtube">YouTube</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#flickr">Flickr</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#wikipedia">Wikipedia</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#id13">腾讯</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#id14">豆瓣</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#facebook">Facebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#amazon">Amazon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#yahoo">Yahoo!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#github">Github</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#disqus">Disqus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#twitter">Twitter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#tumblr">Tumblr</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#stackoverflow">StackOverflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#instagram">Instagram</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#youporn">YouPorn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#reddit">Reddit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../architecture/reference.html#id25">其他</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">入门</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../index.html#id2">推荐阅读</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../os.html">Linux操作系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../os.html#id1">实践篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="../os.html#id2">工具篇</a></li>
<li class="toctree-l2"><a class="reference internal" href="../os.html#id5">原理篇</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../nginx.html">Nginx</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../nginx.html#id1">《Nginx开发从入门到精通》读书笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nginx.html#id2">模块学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nginx.html#id3">实现</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nginx.html#id4">资源</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../uwsgi.html">uWSGI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../db.html">数据库</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../db/memcached.html">Memcached</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/redis.html">Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/mysql.html">MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/sqlite.html">SQLite</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lvs.html">LVS - Linux Virtual Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../varnish.html">Varnish Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../haproxy.html">HAProxy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../haproxy.html#id2">HAProxy源码编译安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../haproxy.html#haproxysyslog-ng">HAProxy的syslog-ng日志配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../haproxy.html#haproxyrsyslogd">HAProxy的rsyslogd日志配置</a></li>
<li class="toctree-l2"><a class="reference internal" href="../haproxy.html#id3">HAProxy命令</a></li>
<li class="toctree-l2"><a class="reference internal" href="../haproxy.html#haproxy-haproxy">HAProxy配置文件示例（来自 HAProxy的安装和部署 ）</a></li>
<li class="toctree-l2"><a class="reference internal" href="../haproxy.html#id5">参考材料</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../keepalived.html">Keepalived</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../keepalived.html#tlinuxkeepalived">tlinux上源码编译安装Keepalived</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keepalived.html#vrrp">VRRP协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keepalived.html#id1">Keepalived原理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keepalived.html#id2">参考资料</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../fabric.html">Fabric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supervisor.html">Supervisor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gunicorn.html">Gunicorn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../openvpn.html">OpenVPN</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../openvpn.html#vpn">如何让客户端流量全部走VPN？</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Docker/LXC</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../docker.html#id1">推荐资料</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dns.html">DNS/BIND</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dns.html#bind9-9-3">编译安装BIND9.9.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dns.html#bind-dns">配置BIND（缓存DNS）</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../zookeeper.html">Zookeeper</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../zookeeper.html#zookeeper-overview">Zookeeper Overview</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../saltstack.html">SaltStack</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../saltstack.html#saltstack-walkthrough">SaltStack Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="../saltstack.html#id2">相关链接</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../zabbix.html">Zabbix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../buildbot.html">Buildbot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../coreos.html">coreOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ntp.html">NTP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../ntp.html#ntp-conf">配置文件ntp.conf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ntp.html#linux">Linux系统时间与硬件时间</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ntp.html#id3">Linux系统时区与手动校时工作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ntp.html#id4">Linux的网络校时</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../influxdb.html">InfluxDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../influxdb.html#id1">参考资料</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../heka.html">heka</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../heka.html#id1">Heka文档阅读笔记</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../development/php.html">PHP</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/php/basic.html">基础知识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/php/basic.html#php">《PHP手册》阅读笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/php/basic.html#id10">常用函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/php/php-internal.html">深入理解PHP内核</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/python.html">Python</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/basic.html">基础知识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/best-practices.html">最佳实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/libs.html">第三方库集锦</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/django.html">Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/django.html#id1">参考资料</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/Celery.html">Celery</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/gunicorn.html">Gunicorn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/eventlet.html">Eventlet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/paramiko.html">Paramiko</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/sentry.html">sentry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/virtualenv.html">virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/scipy.html">SciPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/python/sqlalchemy.html">SQLAlchemy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/js.html">JavaScript</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/js/basic.html">JavaScript基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/js/nodejs.html">Node.js</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/css.html">CSS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/css/basic.html">基础知识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/css/bootstrap.html">Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/css/semantic-ui.html">Semantic UI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/css/css-mastery.html">读书笔记：精通CSS-高级Web标准解决方案</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/css.html#id1">推荐阅读</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/shell.html">Shell编程</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/go.html">Go语言</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/golang/go-web-programming.html">《Go Web编程》读书笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/golang/go-learning-note.html">Go学习笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/golang/a-tour-of-go.html">&lt;A tour of Go&gt;学习笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/golang/note-effective-go.html">&lt;Effective Go&gt;学习笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/go.html#id1">语言基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/go.html#web">Web开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/go.html#id5">标准库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/go.html#id6">第三方库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/go.html#id7">Web框架</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/go.html#id8">推荐阅读</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/web.html">Web开发问题记录</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../development/web.html#id1">响应式设计</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/web.html#id6">工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/web.html#id9">浏览器兼容问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/web.html#id10">最佳实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../development/web.html#id11">推荐阅读</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../development/make.html">CMake/Make</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/r.html">R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/octave.html">Octave</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../base/os.html">操作系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../base/os.html#id2">参考资料</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../base/compiler.html">编译原理</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../base/compiler.html#id2">参考资料</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../base/algorithm.html">算法与数据结构</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../base/algorithm.html#id2">贝塞尔曲线</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../base/network.html">网络</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../base/network/sdn.html">软件定义网络（SDN）</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../base/network/rsync.html">Rsync</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../base/network/oauth2.html">OAuth2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../base/network/read_hpbn.html">读书笔记：High-Performance Browser Networking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../base/network.html#id2">推荐阅读</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../base/security.html">Web安全</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../others/quotes.html">启示语录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../others/data-visual.html">数据可视化</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#acharts">acharts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#echarts">ECharts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#polymaps">Polymaps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#highcharts-js">Highcharts JS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#amcharts">amCharts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#peity">Peity</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#kartograph">Kartograph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#d3-js">D3.js</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#raphael">Raphael</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#nvd3">NVD3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#flot">Flot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#javascript-infovis-toolkit">JavaScript InfoVis Toolkit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#rickshaw">Rickshaw</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#graph-tool">graph-tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#chap-links-library">CHAP Links Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/data-visual.html#id2">参考资料</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../others/git.html">Git学习笔记</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../others/git/git-simple-guide.html">Git-简易指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/git/visual-git-guide.html">图解Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/git/pro-git-cn.html">Pro Git</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../others/message_queue.html">消息队列</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../others/message_queue.html#id2">推荐阅读</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../others/storage.html">数据存储</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../others/storage.html#bitcask">BitCask</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../others/distributed-system.html">分布式系统</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../others/distributed-system.html#id2">推荐阅读</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../others/quora-collection.html">Quora问答精选</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../others/stackoverflow-collection.html">StackOverflow问答精选</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../others/other.html">碎碎念</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../others/other/taobao-ten-years.html">《淘宝技术这十年》读书笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../others/other/inspired.html">启示录-打造用户喜爱的产品</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">学习笔记</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../saltstack.html">SaltStack</a> &raquo;</li>
      
    <li>How Do I Use Salt States?</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../../sources/operations/saltstack/starting_states.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="how-do-i-use-salt-states">
<h1>How Do I Use Salt States?<a class="headerlink" href="#how-do-i-use-salt-states" title="Permalink to this headline">¶</a></h1>
<p>The core of the Salt State system is the SLS, or <strong>S</strong>a<strong>L</strong>t<strong>S</strong> tate file. The SLS is a representation of the state in which a system should be in, and is set up to contain this data in a simple format. This is often called
configuration management.</p>
<div class="section" id="the-top-file">
<h2>The Top File<a class="headerlink" href="#the-top-file" title="Permalink to this headline">¶</a></h2>
<p>The example SLS files in the below section can be assigned to hosts using a file called <strong>top.sls</strong> .</p>
<p>The top file is used <strong>to map what SLS modules get loaded onto what minions via the state system</strong> . The top file creates a few general abstractions. First it maps what nodes should pull from which environments,
next it defines which matches systems should draw from.</p>
<div class="section" id="environments">
<h3>Environments<a class="headerlink" href="#environments" title="Permalink to this headline">¶</a></h3>
<p>The environments in the top file corresponds with the environments defined in the <tt class="docutils literal"><span class="pre">file_roots</span></tt> variable. In a simple, single environment setup you only have the <tt class="docutils literal"><span class="pre">base</span></tt> environment, and therefore only one state tree.
Here is a simple example of <tt class="docutils literal"><span class="pre">file_roots</span></tt> in the master configuration(默认为/etc/salt/master):</p>
<div class="highlight-python"><div class="highlight"><pre>file_roots:
    base:
        - /srv/salt
</pre></div>
</div>
<p>This means that the top file will only have one environment to pull from, here is a simple, single environment top file:</p>
<div class="highlight-python"><div class="highlight"><pre>base:
    &#39;*&#39;:
        - core
        - edit
</pre></div>
</div>
<p>This also means that <tt class="docutils literal"><span class="pre">/srv/salt</span></tt> has a state tree. But if you want to use multiple environments, or partition the file server to serve more than just the state tree, then the <tt class="docutils literal"><span class="pre">file_roots</span></tt> option can be expanded:</p>
<div class="highlight-python"><div class="highlight"><pre>file_roots:
    base:
        - /srv/salt/base
    dev:
        - /srv/salt/dev
    qa:
        - /srv/salt/qa
    prod:
        - /srv/salt/prod
</pre></div>
</div>
<p>Then out top files could reference the environments:</p>
<div class="highlight-python"><div class="highlight"><pre>dev:
    &#39;webserver*dev*&#39;:
        - webserver
    &#39;db*dev*&#39;:
        - db
qa:
    &#39;webserver*qa*&#39;:
        - webserver
    &#39;db*qa*&#39;:
        - db
prod:
    &#39;webserver*prod*&#39;:
        - webserver
    &#39;db*prod*&#39;:
        - db
</pre></div>
</div>
<p>In this setup we have state trees in three of the four environments, and no state tree in the base environment. Notice that the targets for the minions specify environment data. In Salt the master determines who is in what environment,
and many environments can be crossed together. For instance, a separate global state tree could be added to the base environment if it suits your deployment:</p>
<div class="highlight-python"><div class="highlight"><pre>base:
    &#39;*&#39;:
        - global
dev:
    &#39;webserver*dev*&#39;:
        - webserver
    &#39;db*dev*&#39;:
        - db
qa:
    &#39;webserver*qa*&#39;:
        - webserver
    &#39;db*qa*&#39;:
        - db
prod:
    &#39;webserver*prod*&#39;:
        - webserver
    &#39;db*prod*&#39;:
        - db
</pre></div>
</div>
</div>
<div class="section" id="other-ways-of-targeting-minions">
<h3>Other Ways of Targeting Minions<a class="headerlink" href="#other-ways-of-targeting-minions" title="Permalink to this headline">¶</a></h3>
<p>Here is a slightly more complex top file example, showing the different types of matches you can perform:</p>
<div class="highlight-python"><div class="highlight"><pre>base:
    &#39;*&#39;:
        - ldap-client
        - networking
        - salt.minion

    &#39;salt-master*&#39;:
        - salt.master

    &#39;^(memcache|web).(qa|prod).loc$&#39;:
        - match: pcre
        - nagios.mon.web
        - apache.server

    &#39;os:Ubuntu&#39;:
        - match: grain
        - repos.ubuntu

    &#39;os:(RedHat|CentOS)&#39;:
        - match: grain_pcre
        - repos.epel

    &#39;foo,bar,baz&#39;:
        - match: list
        - database

    &#39;somekey:abc&#39;:
        - match: pillar
        - xyz

    &#39;nag1* or G@role:monitoring&#39;:
        - match: compound
        - nagios.server
</pre></div>
</div>
<p>In this example <tt class="docutils literal"><span class="pre">top.sls</span></tt> , all minions get the ldap-client, networking and salt.minion states. Any minion with an id matching the <tt class="docutils literal"><span class="pre">salt-master*</span></tt> glob will get the salt.master state. Any minion with ids matching
the regular expression <tt class="docutils literal"><span class="pre">^(memcache|web).(qa|prod).loc$</span></tt> will get the nagios.mon.web and apache.server states. All Ubuntu minions will receive the repos.ubuntu state, while all RHEL and CentOS minions will receive
the repos.epel state. The minions <tt class="docutils literal"><span class="pre">foo</span></tt>, <tt class="docutils literal"><span class="pre">bar</span></tt>, and <tt class="docutils literal"><span class="pre">baz</span></tt> will receive the database state. Any minion with a pillar named <tt class="docutils literal"><span class="pre">somekey</span></tt>, having a value of <tt class="docutils literal"><span class="pre">abc</span></tt> will receive the xyz state. Finally, minions
with ids matching the nag1* glob or with a grain named <tt class="docutils literal"><span class="pre">role</span></tt> equal to <tt class="docutils literal"><span class="pre">monitoring</span></tt> will receive the nagios.server state.</p>
</div>
<div class="section" id="how-top-files-are-compiled">
<h3>How Top Files Are Compiled<a class="headerlink" href="#how-top-files-are-compiled" title="Permalink to this headline">¶</a></h3>
<p>As mentioned earlier, the top files in the different environments are compiled into a single set of data. The way in which this is done follows a few rules, which are important
to understand when arranging top files in different environments.</p>
<ol class="arabic simple">
<li>The <tt class="docutils literal"><span class="pre">base</span></tt> environment&#8217;s top file is processed first. Any environment which is defined in the <tt class="docutils literal"><span class="pre">base</span></tt> top.sls as well as another environment&#8217;s top file, will use the instance of the environment configured in <tt class="docutils literal"><span class="pre">base</span></tt>
and ignore all other instances. In other words, the <tt class="docutils literal"><span class="pre">base</span></tt> top file is authoritative when defining environments. Therefore, in the example below, the <tt class="docutils literal"><span class="pre">dev</span></tt> section in <tt class="docutils literal"><span class="pre">/srv/salt/dev/top.sls</span></tt> would be completely ignored.</li>
</ol>
<p><tt class="docutils literal"><span class="pre">/srv/salt/base/top.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>base:
    &#39;*&#39;:
        - common
dev:
    &#39;webserver*dev*&#39;:
        - webserver
    &#39;db*dev*&#39;:
        - db
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">/srv/salt/dev/top.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>dev:
    &#39;10.10.100.0/24&#39;:
        - match: ipcidr
        - deployments.dev.site1
    &#39;10.10.101.0/24&#39;:
        - match: ipcidr
        - deployments.dev.site2
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The rules below assume that the environments being discussed were not defined in the base <tt class="docutils literal"><span class="pre">top</span></tt> file.</p>
</div>
<ol class="arabic simple" start="2">
<li>If, for some reason, the <tt class="docutils literal"><span class="pre">base</span></tt> environment is not configured in the <tt class="docutils literal"><span class="pre">base</span></tt> environment&#8217;s top file, then the other environments will be checked in alphabetical order. The first top file found to contain a section for
the <tt class="docutils literal"><span class="pre">base</span></tt> environment wins, and the other top files&#8217; <tt class="docutils literal"><span class="pre">base</span></tt> sections are ignored. So, provided there is no <tt class="docutils literal"><span class="pre">base</span></tt> section in the <tt class="docutils literal"><span class="pre">base</span></tt> top file, with the below two top files the <tt class="docutils literal"><span class="pre">dev</span></tt> environment would win out,
and the <tt class="docutils literal"><span class="pre">common.centos</span></tt> SLS would not be applied to CentOS hosts.</li>
</ol>
<p><tt class="docutils literal"><span class="pre">/srv/salt/dev/top.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>base:
    &#39;os:Ubuntu&#39;:
        - common.ubuntu
dev:
    &#39;webserver*dev*&#39;:
        - webserver
    &#39;db*dev*&#39;:
        - db
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">/srv/salt/qa/top.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>base:
    &#39;os:Ubuntu&#39;:
        - common.ubuntu
    &#39;os:CentOS&#39;:
        - common.centos
qa:
    &#39;webserver*qa*&#39;:
        - webserver
    &#39;db*qa*&#39;:
        - db
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>For environments other than <tt class="docutils literal"><span class="pre">base</span></tt>, the top file in a given environment will be checked for a section matching the environment&#8217;s name. If one is found, then it is used. Otherwise, the remaining (non-<tt class="docutils literal"><span class="pre">base</span></tt>) environments
will be checked in alphabetical order. In the below example, the <tt class="docutils literal"><span class="pre">qa</span></tt> section in <tt class="docutils literal"><span class="pre">/srv/salt/dev/top.sls</span></tt> will be ignored, but if <tt class="docutils literal"><span class="pre">/srv/salt/qa/top.sls</span></tt> were cleared or removed, then the states configured for the <tt class="docutils literal"><span class="pre">qa</span></tt>
environment in <tt class="docutils literal"><span class="pre">/srv/salt/dev/top.sls</span></tt> will be applied.</li>
</ol>
<p><tt class="docutils literal"><span class="pre">/srv/salt/dev/top.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>dev:
    &#39;webserver*dev*&#39;:
        - webserver
    &#39;db*dev*&#39;:
        - db
qa:
    &#39;10.10.200.0/24&#39;:
        - match: ipcidr
        - deployments.qa.site1
    &#39;10.10.201.0/24&#39;:
        - match: ipcidr
        - deployments.qa.site2
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">/srv/salt/qa/top.sls:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre>qa:
    &#39;webserver*qa*&#39;:
        - webserver
    &#39;db*qa*&#39;:
        - db
</pre></div>
</div>
</div>
</div>
<div class="section" id="default-data-yaml">
<h2>Default Data - YAML<a class="headerlink" href="#default-data-yaml" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre>apache:
    pkg:
        - installed
    service:
        - running
        - require:
            - pkg: apache
</pre></div>
</div>
</div>
<div class="section" id="adding-configs-and-users">
<h2>Adding Configs and Users<a class="headerlink" href="#adding-configs-and-users" title="Permalink to this headline">¶</a></h2>
<p>When setting up a service like an Apache web server, many more components may need to be added. The Apache configuration file will most likely be managed, and a user and group may need to be set up.</p>
<div class="highlight-python"><div class="highlight"><pre>apache:
  pkg:
    - installed
  service:
    - running
    - watch:
      - pkg: apache
      - file: /etc/httpd/conf/httpd.conf
      - user: apache
  user.present:
    - uid: 87
    - gid: 87
    - home: /var/www/html
    - shell: /bin/nologin
    - require:
      - group: apache
  group.present:
    - gid: 87
    - require:
      - pkg: apache

/etc/httpd/conf/httpd.conf:
  file.managed:
    - source: salt://apache/httpd.conf
    - user: root
    - group: root
    - mode: 644
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">require</span></tt> statement under service was changed to watch, and is now watching 3 states instead of just one. The watch statement does the same thing as require, making sure that the other states run
before running the state with a watch, but it adds an extra component. The <tt class="docutils literal"><span class="pre">watch</span></tt> statement will run the state&#8217;s watcher function for any changes to the watched states. So if the package was updated,
the config file changed, or the user uid modified, then the service state&#8217;s watcher will be run. The service state&#8217;s watcher just restarts the service, so in this case, a change in the config file
will also trigger a restart of the respective service.</p>
<div class="section" id="moving-beyond-a-single-sls">
<h3>Moving Beyond a Single SLS<a class="headerlink" href="#moving-beyond-a-single-sls" title="Permalink to this headline">¶</a></h3>
<p>When setting up Salt States in a scalable manner, more than one SLS will need to be used.</p>
</div>
<div class="section" id="understanding-the-render-system">
<h3>Understanding the Render System<a class="headerlink" href="#understanding-the-render-system" title="Permalink to this headline">¶</a></h3>
<p>Since SLS data is simply that (data), it does not need to be represented with YAML. Salt defaults to YAML because it is very straightforward and easy to learn and use. But the SLS files can be rendered
from almost any imaginable medium, so long as a renderer module is provided.</p>
<p>The default rendering system is the <tt class="docutils literal"><span class="pre">yaml_jinja</span></tt> renderer. The <tt class="docutils literal"><span class="pre">yaml_jinja</span></tt> renderer will first pass the template through the <a class="reference external" href="http://jinja.pocoo.org/">Jinja2</a> templating system, and then through the YAML parser.
The benefit here is that full programming constructs are available when creating SLS files.</p>
</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="pillar_walkthrough.html" class="btn btn-neutral float-right" title="Pillar Walkthrough">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../saltstack.html" class="btn btn-neutral" title="SaltStack"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, youngsterxyf.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../static/jquery.js"></script>
      <script type="text/javascript" src="../../static/underscore.js"></script>
      <script type="text/javascript" src="../../static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>